- name: Install controller
  gather_facts: True
  hosts: controllers

  tasks:
    - name: Gather facts from new server
      setup:
        filter: ansible_default_ipv4.address

    - name: Creates directory
      file: path=/tmp/avicontroller/ state=directory

    - name: Download software
      get_url:
        url: "https://avinetworks.com/software-downloads/Version-17.2.9/docker_install-17.2.9-9001.tar.gz?Signature=ur7ZnFsyes9secoj5F4SQVAarhI%3D&Expires=1525299960&AWSAccessKeyId=AKIAIXO5A5YMNLOVWNBQ"
        dest: /tmp/avicontroller/cocker_install.tar.gz
        mode: 0440


    - name: Download controller file
      unarchive:
        src:    /tmp/avicontroller/cocker_install.tar.gz
        dest: /tmp/avicontroller
        remote_src: yes

    - name: Run Avi Controller setup
      command: /tmp/avicontroller/avi_baremetal_setup.py -c -cc 4 -cm 12 -i {{ ansible_default_ipv4.address }}


